# 集合演算
<br>

## 集合演算とは
レコード同士の四則演算のこと。
<br>

## テーブルの足し算 -- UNION句
以下の2テーブルが存在しているとして、この2つを一つのテーブルにまとめたい。
Productsテーブル
|id|name|
|--|--|
|0001|シャツ|
|0002|コピー用紙|
|0003|カッター|
|0004|フォーク|
|0005|ボールペン|

Products2テーブル
|id|name|
|--|--|
|0001|シャツ|
|0002|コピー用紙|
|0003|カッター|
|0006|手袋|
|0007|包丁|

以下のSQLで実現できる。
```sql
SELECT id, name
    FROM products
UNION
SELECT id, name
    FROM products2;
```
とすると、
|id|name|
|--|--|
|0001|シャツ|
|0002|コピー用紙|
|0003|カッター|
|0004|フォーク|
|0005|ボールペン|
|0006|手袋|
|0007|包丁|

という結果が返ってくる。
デフォルトだと重複行は排除される。
<br>

## テーブルの共通部分の選択 -- INTERSECT句
逆に重複行のみを出力したい時は、
```sql
SELECT id, name
    FROM products
INTERSECT
SELECT id, name
    FROM products2
ORDER BY id;
```
とすると、
|id|name|
|--|--|
|0001|シャツ|
|0002|コピー用紙|
|0003|カッター|

のように重複している行のみが返ってくる。
<br>

## テーブルの引き算 -- EXCEPT句
引き算がしたい場合は以下のようにSQL実行。
```sql
SELECT id, name
    FROM products
EXCEPT
SELECT id, name
    FROM products2
ORDER BY id;
```
結果は以下。
|id|name|
|--|--|
|0004|フォーク|
|0005|ボールペン|
|0006|手袋|
|0007|包丁|

productsテーブルから、products2テーブルに存在するレコードを削除している。
<br>

## 所感
果たして使い道はあるのだろうか？
pre環境と本番環境の同テーブルの中身に違いがないか調べる時とかに使えるか。。。？

## 参考
[ゼロからはじめるデータベース操作 SQL : 231~239P]https://www.amazon.co.jp/SQL-%E7%AC%AC2%E7%89%88-%E3%82%BC%E3%83%AD%E3%81%8B%E3%82%89%E3%81%AF%E3%81%98%E3%82%81%E3%82%8B%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E6%93%8D%E4%BD%9C-%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E5%AD%A6%E7%BF%92%E3%82%B7%E3%83%AA%E3%83%BC%E3%82%BA-%E3%83%9F%E3%83%83%E3%82%AF/dp/4798144452
